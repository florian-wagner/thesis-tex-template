# Makefile borrowed from here: https://github.com/pinga-lab/paper-template/blob/master/manuscript/Makefile

# Build the PDF
#
# Commands:
#
#	make            Compile PDF in the output folder
#	make show       Show the generated PDF (only Linux and Mac)
#	make clean      Delete all generated files


# CONFIGURATION
###############################################################################

# The name of the main .tex file to build.
# Other latex files should be included into this one.
PROJECT = thesis
# Folder with the figure files
FIGDIR = "./"
# Folder where output will be placed
OUTDIR = output
# Name of the output file
OUTPUT = $(OUTDIR)/$(PROJECT).pdf

### File Types (for dependencies)
TEX = $(wildcard *.tex)
BIB = $(wildcard *.bib)
STY = $(wildcard *.sty)
CLS = $(wildcard *.cls)
BST = $(wildcard *.bst)
EPS = $(wildcard $(FIGDIR)/*.eps)
PNG = $(wildcard $(FIGDIR)/*.png)
PDF = $(wildcard $(FIGDIR)/*.pdf)
JPG = $(wildcard $(FIGDIR)/*.jpg)
FIGS = $(EPS) $(PNG) $(PDF) $(JPG)

### Compilation Flags
LATEX_FLAGS  = -halt-on-error -output-directory $(OUTDIR)/

### Set commands for opening the generated PDF
UNAME := $(shell uname)
ifeq ($(UNAME), Linux)
PDFVIEWER = xdg-open
endif
ifeq ($(UNAME), Darwin)
PDFVIEWER = open
endif


# TARGETS
###############################################################################

# Main target. Executed when calling 'make' with no arguments
all: $(OUTPUT)

# Open the PDF
show: $(OUTPUT)
	@ # Redirect stdout and stderr to /dev/null for silent execution
	@ (${PDFVIEWER} $(OUTPUT) > /dev/null 2>&1 & )

### Clean
# This target cleans the temporary files generated by the tex programs in
# use. All temporary files generated by this makefile will be placed in OUTDIR
# so cleanup is easy.
clean::
	rm -rf $(OUTDIR)/ *.aux
	rm -rf $(FIGDIR)/*-eps-converted-to.pdf

# Compile the PDF output
$(OUTPUT): $(PROJECT).tex $(STY) $(CLS) $(BIB) $(BST) $(FIGS) $(TEX)
	# Create the output directory if it doesn't exist
	mkdir -p $(OUTDIR)/
	cp $(BIB) $(BST) $(OUTDIR)
	pdflatex $(LATEX_FLAGS) $<
	cd $(OUTDIR) && bibtex $(patsubst %.tex,%,$<)
	pdflatex $(LATEX_FLAGS) $< 1>/dev/null
	pdflatex $(LATEX_FLAGS) $<